static_resources:
  listeners:
  # === Outbound: 8090 ===
  - name: listener_outbound_8090
    address:
      socket_address: { address: 0.0.0.0, port_value: 8090 }
    listener_filters:
    - name: envoy.filters.listener.original_dst
      typed_config:
        "@type": type.googleapis.com/envoy.extensions.filters.listener.original_dst.v3.OriginalDst
    # transparent: true
    filter_chains:
    - filters:
      - name: envoy.filters.network.tcp_proxy
        typed_config:
          "@type": type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy
          stat_prefix: tcp_outbound
          cluster: cluster_original_dst
    socket_options:
    - level: SOL_SOCKET
      name: SO_MARK
      int_value: 131     # 0x83
      state: STATE_LISTENING

  # === Inbound: 8092 ===
  - name: listener_inbound_8092
    address:
      socket_address: { address: 0.0.0.0, port_value: 8092 }
    listener_filters:
    - name: envoy.filters.listener.original_dst
      typed_config:
        "@type": type.googleapis.com/envoy.extensions.filters.listener.original_dst.v3.OriginalDst
    # transparent: true
    filter_chains:
    - filters:
      - name: envoy.filters.network.tcp_proxy
        typed_config:
          "@type": type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy
          stat_prefix: tcp_inbound
          cluster: cluster_original_dst

  clusters:
  - name: cluster_original_dst
    type: ORIGINAL_DST
    connect_timeout: 5s
    lb_policy: CLUSTER_PROVIDED
    # 可选：如需为每个目标创建独立连接池
    original_dst_lb_config:
      use_http_header: false

admin:
  address:
    socket_address: { address: 127.0.0.1, port_value: 15000 }
