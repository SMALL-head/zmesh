FROM ubuntu:22.04

# 设置环境变量
ENV DEBIAN_FRONTEND=noninteractive
ENV GO_VERSION=1.24.4
ENV PATH=$PATH:/usr/local/go/bin
ENV GOPATH=/go
ENV PATH=$PATH:$GOPATH/bin

WORKDIR /init

# 安装基础工具和依赖
RUN apt-get update && apt-get install -y \
    git \
    curl \
    wget \
    vim \
    make \
    gcc \
    g++ \
    pkg-config \
    iptables \
    iproute2 \
    net-tools \
    iputils-ping \
    tcpdump \
    libpcap-dev \
    bridge-utils \
    ethtool \
    sudo \
    && rm -rf /var/lib/apt/lists/*

# 下载并安装 Go
COPY go1.24.4.linux-amd64.tar.gz go1.24.4.linux-amd64.tar.gz
RUN tar -C /usr/local -xzf go${GO_VERSION}.linux-amd64.tar.gz \
    && rm go${GO_VERSION}.linux-amd64.tar.gz

# 创建工作目录
RUN mkdir -p /go/src /go/bin /go/pkg

# 安装常用的 Go 工具
RUN go env -w GOPROXY=https://goproxy.cn,direct \
    && go install golang.org/x/tools/gopls@latest \
    && go install github.com/go-delve/delve/cmd/dlv@latest \
    && go install golang.org/x/tools/cmd/goimports@latest \
    && go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest

# 设置默认命令
CMD ["tail", "-f", "/dev/null"]

